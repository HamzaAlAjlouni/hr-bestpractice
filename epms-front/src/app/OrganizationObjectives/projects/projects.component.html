<!-- Content Header (Page header) -->
<section class="content-header" *ngIf="!AddOnFly">
  <h1>
    {{ GetLocalResourceObject("lblOrganizationProjects") }}
    <small>{{ GetLocalResourceObject("lblSettings") }}</small>
  </h1>
  <ol class="breadcrumb">
    <li>{{ GetLocalResourceObject("lblSettings") }}</li>
    <li class="active">{{ GetLocalResourceObject("lblProjects") }}</li>
  </ol>
</section>

<!--Projects-->
<section class="content">
  <div class="row" *ngIf="!AddOnFly">
    <div class="col-md-12">
      <div class="box box-primary">
        <div class="box-header with-border">
          <h3 class="box-title">{{ GetLocalResourceObject("lblSearch") }}</h3>
        </div>
        <form #ProjectsForm="ngForm">
          <div class="box-body">
            <div class="row">
              <div class="col-xs-3">
                <label>{{ GetLocalResourceObject("lblYear") }}</label>
                <select
                  required
                  class="form-control"
                  name="ddlYear"
                  id="ddlYear"
                  (change)="ddlYearChange()"
                  [(ngModel)]="ddlYear"
                  #ddlYearRef="ngModel"
                >
                  <option *ngFor="let x of yearLst" value="{{ x.id }}">
                    {{ x.year }}
                  </option>
                </select>

                <ValidatorCallOut
                  ID="ddlYearValidator"
                  [Visibiltiy]="ddlYearRef.invalid && ddlYearRef.touched"
                  [ControlToValidate]="ddlYearRef"
                  ErrorMessage="This field is required."
                >
                </ValidatorCallOut>
              </div>
              <div class="col-xs-3">
                <label>{{ GetLocalResourceObject("lblUnit") }}</label>
                <select
                  class="form-control"
                  name="ddlUnit"
                  id="ddlUnit"
                  (change)="GetProjects()"
                  [(ngModel)]="ddlUnit"
                >
                  <option [value]="null" selected>
                    {{ GetLocalResourceObject("lblAll") }}
                  </option>
                  <option *ngFor="let x of unitLst" value="{{ x.ID }}">
                    {{ x.NAME }}
                  </option>
                </select>
              </div>
              <div class="col-xs-3">
                <label>{{
                    GetLocalResourceObject("lblStratigicObjective")
                  }}</label>
                <select
                  required
                  (change)="ddlStratigicObjChange(ddlStratigicObj)"
                  class="form-control"
                  name="ddlStratigicObj"
                  id="ddlStratigicObj"
                  [(ngModel)]="ddlStratigicObj"
                  #ddlStratigicObjRef="ngModel"
                >
                  <option [value]="0" selected>
                    {{ GetLocalResourceObject("lblAll") }}
                  </option>
                  <option
                    *ngFor="let x of stratigicObjectivLst"
                    value="{{ x.id }}"
                  >
                    {{ x.name }}
                  </option>
                </select>

                <ValidatorCallOut
                  ID="ddlStratigicObjValidator"
                  [Visibiltiy]="
                    ddlStratigicObjRef.invalid && ddlStratigicObjRef.touched
                  "
                  [ControlToValidate]="ddlStratigicObjRef"
                  ErrorMessage="This field is required."
                >
                </ValidatorCallOut>
              </div>
              <div class="col-xs-3">
                <label>
                  Objective KPIs
                </label>
                <select
                  required
                  (change)="ddlStratigicObjKpiChange(ddlStratigicObjKpi)"
                  class="form-control"
                  name="ddlStratigicObjKpi"
                  id="ddlStratigicObjKpi"
                  [(ngModel)]="ddlStratigicObjKpi"
                  #ddlStratigicObjRef="ngModel"
                >
                  <option [value]="0" selected>
                    {{ GetLocalResourceObject("lblAll") }}
                  </option>
                  <option
                    *ngFor="let x of projectKpis"
                    value="{{ x.ID }}"
                  >
                    {{ x.Name }}
                  </option>
                </select>

              </div>
              <div class="col-xs-3">
                <label style="margin-top:1rem;">Project Status</label>
                <select
                  [(ngModel)]="ddlProjectStatus"
                  class="form-control"
                  id="ddlProjectStatus"
                  name="ddlProjectStatus"
                >
                  <option value="">All</option>
                  <option value="Waiting Approval">Waiting Approval</option>
                  <option value="Confirmed">Confirmed</option>
                  <option value="Declined">Declined</option>
                </select>

              </div>


<!--                            <div class="col-xs-3">-->
<!--                              <label style="margin-top: 1rem;">Category</label>-->
<!--                              <select-->
<!--                                class="form-control"-->
<!--                                name="ddl"-->
<!--                                id="ddlCategory"-->
<!--                                [(ngModel)]="ddlCategory"-->
<!--                              >-->
<!--                                <option [value]="null" selected>-->
<!--                                  {{ GetLocalResourceObject("lblAll") }}-->
<!--                                </option>-->
<!--                                <option *ngFor="let z of projectsCategories" value="{{ z.ID }}">-->
<!--                                  {{ z.Name }}-->
<!--                                </option>-->
<!--                              </select>-->
<!--                            </div>-->

            </div>

          </div>
          <!-- /.box-body -->

          <div class="box-footer" style="text-align: right">
            <button
              [disabled]="ProjectsForm.invalid"
              class="btn btn-primary pull-right"
              (click)="GetProjects()"
            >
              {{ GetLocalResourceObject("lblSearch") }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="" *ngIf="!AddOnFly">
    <!-- left column -->
    <div class="">
      <!-- general form elements -->
      <div class="box box-primary">

        <!-- /.box-header -->
        <div *ngIf="showPlannedWeight" class="box-body">
          <div
            *ngIf="(ddlUnit == undefined || this.ddlUnit == 'null') &&(ddlStratigicObj == undefined || this.ddlStratigicObj == 0); else filtered"
            class="row">
            <div class="col-md-6 border-right">
              <div class="description-block">
                <h5 class="description-header mb-4">{{ plannedWeight }}%</h5>
                <br>
                <span class="description-text mt-5">{{ "reviewAndAssesment.plannedWeight" | translate }}</span>
              </div>

            </div>
            <div class="col-md-6">
              <div class="description-block">
                <h5 class="description-header mb-4">{{ notPlannedWeight }}%</h5>
                <br>
                <span class="description-text mt-5">Not Planned</span>
              </div>

            </div>


          </div>
          <ng-template #filtered>
            <div class="row">
              <div class="col-md-12">
                <div class="description-block">
                  <h5 class="description-header mb-4">{{ plannedWeight }}%</h5>
                  <br>
                  <span class="description-text mt-5">{{ "reviewAndAssesment.plannedWeight" | translate }}</span>
                </div>

              </div>


            </div>


          </ng-template>

        </div>

      </div>
      <!-- /.box -->
    </div>

    <!--/.col (right) -->
  </div>

  <div class="row" *ngIf="!AddOnFly || ShowProjectList">
    <div class="col-xs-12">
      <div class="box">
        <div class="box-header" style="vertical-align: middle">
          <h3 class="box-title">{{ GetLocalResourceObject("lblProjects") }} ({{projectsFilteredList?.length}})</h3>
          <div class="pull-right box-tools">
            <button
              type="button"
              *ngIf="AddButton_Enabled"
              class="btn btn-success btn-sm btn-Add-right"
              (click)="AddProject()"
              data-widget="Add"
              data-toggle="tooltip"
              title=""
              data-original-title="Add"
            >
              <i class="fa fa-plus"></i>
            </button>
          </div>
        </div>
        <!-- /.box-header -->
        <div class="box-body">
          <span
            class="label table-label-lg"
            style="background-color: #959595; color: #6b41c5"
          >{{ GetLocalResourceObject("optProcess") }}</span
          >
          <!-- <DataGrid #gvProjects [ShowButtons]='true' [RowSelection]='false' [AllowExportExcel]='false'
                        [HideFooter]='false' (GridEvent)='gvProjectsEvent($event);'>
                    </DataGrid>-->

          <div
            class="box-body table-responsive no-padding"
            [(ngModel)]="formRow"
          >
            <table class="table table-hover" align="center">
              <tbody>
              <tr>
                <th style="width: 15%">
                  {{ GetLocalResourceObject("lblProject") }}
                </th>
                <th style="width: 10%">
                  {{ GetLocalResourceObject("lblUnit") }}
                </th>
                <th style="width: 8%">
                  {{ weightCalculation == 1 ? "SKPI Weight" : "SO Weight" }}
                </th>
                <th style="width: 5%">
                  <!--                  {{ GetLocalResourceObject("lblWeight") }}-->
                  Project Weight
                </th>
                <th>{{ "strategic.project.kpis" | translate }}</th>
                <th style="width: 8%">
                  <!--                  {{ "strategic.project.plannedStrategy" | translate }} %-->
                  SO Planned Weight
                </th>
                <th style="width: 6%">
                  {{ GetLocalResourceObject("lblPlannedCost") }}
                </th>
                <th style="width: 6%">{{ "strategic.project.Status" | translate }}</th>
                <th style="width: 6%">{{ "strategic.project.Actions" | translate }}</th>
              </tr>
              <ng-container *ngFor="let x of projectsFilteredList; let i = index">
                <tr [id]="'project'+x.ID"
                  [style.background-color]="
                      x.style == 'service' ? '#959595' : ''
                    "
                >
                  <td align="center" class="td-col3" style="font-size: 16px">
                    <a (click)="OpenModal(x.ID)">
                      {{ x.Name }}
                    </a>
                  </td>
                  <td align="center" class="td-col3">{{ x.UnitName }}</td>
                  <td align="center" class="td-col3">{{ weightCalculation == 1 ? x.KPIWeight : x.SoWeight }}%</td>
                  <td align="center" class="td-col3">
                    <!--                    {{ caculateWeightForList( x) }}%-->
                    {{ x.WeigthValue.toFixed(2) }} %
                  </td>

                  <td>
                    <table
                      class="table"
                      align="center"
                      style="background-color: bisque"
                    >
                      <tbody>
                      <tr>
                        <th style="width: 40%">
                          {{ "strategic.project.kpis" | translate }}
                        </th>
                        <th>{{ GetLocalResourceObject("lblQ1T") }}</th>
                        <th>{{ GetLocalResourceObject("lblQ2T") }}</th>
                        <th>{{ GetLocalResourceObject("lblQ3T") }}</th>
                        <th>{{ GetLocalResourceObject("lblQ4T") }}</th>
                        <th>{{ GetLocalResourceObject("lblTarget") }}</th>
                      </tr>
                      <tr *ngFor="let y of x.KPIs; let d = index">
                        <td align="center" class="td-col1">
                          <i
                            [class]=" y.BetterUpDown===2 ?'fa fa-arrow-down': 'fa fa-arrow-up'"></i>    {{ y.KPI_name }}
                        </td>
                        <td align="center" class="td-col1">
                          {{ y.Q1_Target }}
                        </td>
                        <td align="center" class="td-col1">
                          {{ y.Q2_Target }}
                        </td>
                        <td align="center" class="td-col1">
                          {{ y.Q3_Target }}
                        </td>
                        <td align="center" class="td-col1">
                          {{ y.Q4_Target }}
                        </td>
                        <td align="center" class="td-col1">
                          {{ y.Target }}
                        </td>
                      </tr>
                      </tbody>
                    </table>
                  </td>

                  <td align="center" class="td-col3">
                    {{ x.plannedStratigy.toFixed(2) }}
                  </td>
                  <td align="center" class="td-col3">{{ x.PlannedCost }}</td>
                  <td align="center" class="td-col3">
                    <a (click)="openApprovalModal(x)">
                      {{ x.planned_status }}

                    </a>

                  </td>
                  <td class="table-actions" style="width: 7%">

                    <a *ngIf="hasEditPermission(x)"
                       class="Edit GirdIcons"
                       data-toggle="tooltip"
                       title="Edit"
                       (click)="EditProjectEvent(x.ID)"
                    ><i class="fa fa-edit"></i> &nbsp;
                    </a>
                    <a
                      class="Edit GirdIcons"
                      data-toggle="tooltip"
                      title="Details"
                      (click)="ProjectDetailsEvent(x.ID)"
                    ><i class="fa fa-list-alt"></i> &nbsp;
                    </a>
                    <a
                      *ngIf="hasEditPermission(x)"
                      class="Edit GirdIcons"
                      data-toggle="tooltip"
                      title="Delete"
                      (click)="DeleteProjectEvent(x.ID)"
                    ><i class="fa fa-trash"></i> &nbsp;
                    </a>
                  </td>
                </tr>
              </ng-container>
              </tbody>
            </table>
          </div>
        </div>
        <!-- /.box-body -->
      </div>
    </div>
  </div>
  <div class="row" id="entryPanel">
    <div class="col-md-12" [style.display]="ShowEntryPnl ? 'block' : 'none'">
      <div class="box box-primary">
        <div class="box-header with-border" *ngIf="!AddOnFly">
          <h3 class="box-title">
            {{ GetLocalResourceObject("lblProjectDetails") }}
            {{ ObjectiveTitleForSelectedProject }}
          </h3>
        </div>
        <form #ProjectForm="ngForm">
          <div class="box-body" #EntryPanel>
            <div class="row">
              <div class="col-xs-1">
                <label class="switch">
                  <input
                    type="checkbox"
                    id="chkIsProcess"
                    name="chkIsProcess"
                    [(ngModel)]="chkIsProcess"
                    (change)="toggleProcess()"
                  />
                  <span class="slider round"></span>
                </label>
              </div>
              <div class="col-xs-1">
                <label style="padding-top: 6px; font-size: 1em">
                  {{
                    chkIsProcess
                      ? GetLocalResourceObject("optProcess")
                      : GetLocalResourceObject("lblProjectName")
                  }}
                </label>
                <!-- <label>{{chkIsProcess}}</label> -->
              </div>
            </div>
            <hr/>
            <div class="row">
              <div class="col-xs-12">
                <label>
                  {{
                    chkIsProcess
                      ? GetLocalResourceObject("optProcess")
                      : GetLocalResourceObject("lblProjectName")
                  }}
                </label>
                <input
                  type="text"
                  required
                  class="form-control"
                  name="txtProjectName"
                  id="txtProjectName"
                  [(ngModel)]="oProjects.Name"
                  #txtProjectNameRef="ngModel"
                />

                <ValidatorCallOut
                  ID="txtProjectNameValidator"
                  [Visibiltiy]="
                    txtProjectNameRef.invalid && txtProjectNameRef.touched
                  "
                  [ControlToValidate]="txtProjectNameRef"
                  ErrorMessage="This field is required."
                >
                </ValidatorCallOut>
              </div>
            </div>

            <div class="row">
              <div class="col-xs-12">
                <label
                  style="margin-top: 1rem;margin-bottom: .5rem">{{ GetLocalResourceObject("lblDescription") }}</label>
                <textarea
                  class="form-control"
                  placeholder="Type Description ..."
                  rows="2"
                  name="txtDescription"
                  id="txtDescription"
                  [(ngModel)]="oProjects.Description"
                ></textarea>
              </div>
            </div>

            <div class="row">
              <div *ngIf="weightCalculation==1" class="col-xs-4">
                <label style="margin-top: 1rem;margin-bottom: .5rem">{{ "strategic.project.kpis" | translate }}</label>
                <select
                  class="form-control"
                  name="listKPI"
                  id="listKPI"
                  required
                  [(ngModel)]="selectedKpi"
                  (change)="kpiSelectChange(selectedKpi)"
                  #ddlKpiEntryRef="ngModel"

                >
                  <!--                  <option  [value]="null">-->
                  <!--                    Select Kpi-->
                  <!--                  </option>-->
                  <option *ngFor="let kpi of projectKpis" value="{{ kpi.ID }}">
                    {{ kpi.Name }}
                  </option>
                </select>
                <ValidatorCallOut
                  ID="ddlKpiEntryValidator"
                  [Visibiltiy]="
                    ddlKpiEntryRef.invalid && ddlKpiEntryRef.touched
                  "
                  [ControlToValidate]="ddlKpiEntryRef"
                  ErrorMessage="This field is required."
                >
                </ValidatorCallOut>
              </div>

              <div class="col-xs-4">
                <label style="margin-top: 1rem;margin-bottom: .5rem">{{ GetLocalResourceObject("lblUnit") }}</label>
                <select
                  [disabled]="EditMode"
                  required
                  class="form-control"
                  name="ddlUnitEntry"
                  id="ddlUnitEntry"
                  [(ngModel)]="oProjects.UnitId"
                  #ddlUnitEntryRef="ngModel"
                >
                  <option [ngValue]="null" selected>
                    {{ GetLocalResourceObject("lblPleaseSelect") }}
                  </option>
                  <option *ngFor="let unit of getFilteredUnitList()" value="{{ unit.ID }}">
                    {{ unit.NAME }}
                  </option>
                </select>

                <ValidatorCallOut
                  ID="ddlUnitEntryValidator"
                  [Visibiltiy]="
                    ddlUnitEntryRef.invalid && ddlUnitEntryRef.touched
                  "
                  [ControlToValidate]="ddlUnitEntryRef"
                  ErrorMessage="This field is required."
                >
                </ValidatorCallOut>
              </div>

              <div class="col-xs-4">
                <label style="margin-top: 1rem;margin-bottom: .5rem">{{ GetLocalResourceObject("lblTarget") }}</label>
                <input
                  type="Number"
                  required
                  class="form-control"
                  name="txtTarget"
                  id="txtTarget"
                  [(ngModel)]="oProjects.Target"
                  #txtTargetRef="ngModel"
                />
                <ValidatorCallOut
                  ID="txtTargetValidator"
                  [Visibiltiy]="txtTargetRef.invalid && txtTargetRef.touched"
                  [ControlToValidate]="txtTargetRef"
                  ErrorMessage="This field is required."
                >
                </ValidatorCallOut>
              </div>

              <div class="col-xs-4">
                <label style="margin-top: 1rem;margin-bottom: .5rem">
                  {{ GetLocalResourceObject("lblWeight") }}

                  <!--                   (weighted-->
                  <!--                  averages from 1 to 3 )-->

                </label>
                <input type="number" required [max]="remainingProjectsWeight" min="1" class="form-control"

                       name='txtWeight' id='txtWeight1' #txtWeightRef="ngModel" [(ngModel)]='oProjects.Weight'
                       #txtObjectiveWeightRef='ngModel'>

                <!--                <div class="gap-2" style="display: flex ;justify-content: space-between;gap: 1rem ">-->

                <!--                  <h4>1</h4>-->

                <!--                  <input type="range"-->
                <!--                         required-->
                <!--                         class="form-control"-->
                <!--                         name="txtWeight"-->
                <!--                         id="txtWeight1"-->
                <!--                         [(ngModel)]="oProjects.Weight"-->
                <!--                         #txtWeightRef="ngModel"-->

                <!--                         class="form-range" min="1" max="3" step="1">-->
                <!--                  <h4>3</h4>-->
                <!--                </div>-->


                <!--                <div style="display: flex;justify-content: space-between; margin-top: 1rem">-->
                <!--                  <div class="col"><label> selected Value : {{oProjects.Weight}} </label></div>-->
                <!--                  <div class="col">-->

                <!--                    <label>  {{-->
                <!--                      chkIsProcess-->
                <!--                        ? GetLocalResourceObject("optProcess")-->
                <!--                        : GetLocalResourceObject("lblProjectName")-->
                <!--                      }} Weight : {{caculateWeight(oProjects.Weight)}}%-->
                <!--                    </label>-->

                <!--                  </div>-->


                <!--                </div>-->


                <!--                <input-->
                <!--                  type="Number"-->
                <!--                  required-->
                <!--                  class="form-control"-->
                <!--                  name="txtWeight"-->
                <!--                  id="txtWeight"-->
                <!--                  [(ngModel)]="oProjects.Weight"-->
                <!--                  #txtWeightRef="ngModel"-->
                <!--                />-->
                <ValidatorCallOut
                  ID="txtWeightValidator"
                  [Visibiltiy]="txtWeightRef.invalid && txtWeightRef.touched"
                  [ControlToValidate]="txtWeightRef"
                  ErrorMessage="This field is required."
                >
                </ValidatorCallOut>
              </div>
              <div class="col-xs-4">
                <label
                  style="margin-top: 1rem;margin-bottom: .5rem">{{ GetLocalResourceObject("lblPlannedCost") }}</label>
                <input
                  type="number"
                  required
                  class="form-control"
                  name="txtPlannedCost"
                  id="txtPlannedCost"
                  [(ngModel)]="oProjects.PlannedCost"
                  #txtPlannedCostref="ngModel"
                />
                <ValidatorCallOut
                  ID="txtPlannedCostValidator"
                  [Visibiltiy]="
                    txtPlannedCostref.invalid && txtPlannedCostref.touched
                  "
                  [ControlToValidate]="txtPlannedCostref"
                  ErrorMessage="This field is required."
                >
                </ValidatorCallOut>
              </div>
<!--                            <div class="col-xs-4">-->
<!--                              <label style="margin-top: 1rem;margin-bottom: .5rem">Category</label>-->
<!--                              <select-->
<!--                                class="form-control"-->
<!--                                name="ddlCategoryEntry"-->
<!--                                id="ddlCategoryEntry"-->
<!--                                [(ngModel)]="oProjects.Category"-->
<!--                                #ddlCategoryEntryRef="ngModel"-->
<!--                              >-->
<!--                                <option [ngValue]="null" selected>-->
<!--                                  please select category-->
<!--                                </option>-->
<!--                                <option *ngFor="let category of projectsCategories" value="{{ category.ID }}">-->
<!--                                  {{ category.Name }}-->
<!--                                </option>-->
<!--                              </select>-->


<!--                            </div>-->

            </div>

            <!--            <div class="row">-->
            <!--              <div class="col-xs-4">-->
            <!--                <h1 style="margin-bottom: 1rem; margin-top: 2rem"> Evaluations </h1>-->

            <!--              </div>-->

            <!--            </div>-->
            <!--            <div class="row">-->


            <!--              <div class="col-xs-4" *ngFor="let eval of evaluationsList ; index as i">-->
            <!--                <label style="margin-bottom:1rem;">{{eval.Name}}</label>-->
            <!--                <select-->
            <!--                  class="form-control"-->
            <!--                  [(ngModel)]="evaluationValuesList[i]"-->
            <!--                  [name]="'evaluationValuesList['+i+']'"-->
            <!--                  [id]="'evaluationValuesList['+i+']'"-->
            <!--                  #ddlEvaluationEntryRef="ngModel"-->
            <!--                >-->
            <!--                  <option [ngValue]="0" selected>-->
            <!--                    please select evaluation-->
            <!--                  </option>-->
            <!--                  <option *ngFor="let ev of eval.evaluationValues " value="{{ ev.ID }}">-->
            <!--                    {{ ev.Name }}-->
            <!--                  </option>-->
            <!--                </select>-->

            <!--              </div>-->

            <!--            </div>-->
            <!--            &lt;!&ndash; /.box-body &ndash;&gt;-->


          </div>
          <div class="box-footer text-right">
            <button
              class="btn btn-primary btn-sm"
              *ngIf="!AddOnFly"
              (click)="Cancel()"
            >
              cancel
            </button>
            <button
              class="btn btn-primary btn-sm"
              *ngIf="
                    !EditMode ||
                    planned_status == 1 ||
                    (is_reveiwer_user && planned_status == 3) ||
                    (!is_reveiwer_user && planned_status!=2 )
                  "
              [disabled]="ProjectForm.invalid"
              (click)="SaveProject()"
            >
              {{ GetLocalResourceObject("btnSave") }}
            </button>


          </div>
        </form>
      </div>
<!--      <div class="box box-primary">-->
<!--        <div class="box-header with-border" *ngIf="!AddOnFly">-->
<!--          <h3 class="box-title">-->
<!--            Approvals-->
<!--          </h3>-->
<!--        </div>-->
<!--        <form #ProjectForm="ngForm">-->
<!--          <div class="box-body" #EntryPanel>-->


<!--            <table class="table table-hover" align="center">-->

<!--              <tbody>-->
<!--              <tr>-->
<!--                <th style="width: 15%">-->
<!--                  Status-->
<!--                </th>-->
<!--                <th style="width: 15%">-->
<!--                  Created By-->
<!--                </th>-->
<!--                <th style="width: 10%">-->
<!--                  Date-->
<!--                </th>-->
<!--                <th style="width: 40%">-->
<!--                  Note-->
<!--                </th>-->

<!--              </tr>-->
<!--              <ng-container *ngFor="let x of oProjects.Approvals; let i = index">-->
<!--                <tr-->
<!--                  [style.background-color]="-->
<!--                      x.style == 'service' ? '#959595' : ''-->
<!--                    "-->
<!--                >-->
<!--                  <td align="center" class="td-col3" style="font-size: 16px">-->
<!--                    {{ x.Status == 2 ? "Confirmed" : x.Status == 1 ? "Waiting For Approval" : "Declined" }}-->
<!--                  </td>-->
<!--                  <td align="center" class="td-col3">{{ x.CreatedBy }}</td>-->
<!--                  <td align="center" class="td-col3">{{ x.CreatedDate }}</td>-->
<!--                  <td align="center" class="td-col3">{{ x.Note }}</td>-->


<!--                </tr>-->
<!--              </ng-container>-->
<!--              </tbody>-->


<!--            </table>-->


<!--            &lt;!&ndash; /.box-body &ndash;&gt;-->


<!--          </div>-->
<!--          <div class="box-footer text-right">-->

<!--            <div class="margin-bottom">-->

<!--              <textarea-->
<!--                class="form-control"-->
<!--                placeholder="Type your notes ..."-->
<!--                rows="2"-->
<!--                name="approvalNote"-->
<!--                id="approvalNote"-->
<!--                [(ngModel)]="approvalNote"-->
<!--              ></textarea>-->
<!--            </div>-->
<!--            <button-->
<!--              class="btn btn-primary btn-sm"-->
<!--              [disabled]="ProjectForm.invalid"-->
<!--              *ngIf="is_reveiwer_user && EditMode && planned_status != 2"-->
<!--              (click)="ConfirmProject()"-->
<!--            >-->
<!--              Confirm-->
<!--            </button>-->
<!--            <button-->
<!--              class="btn btn-primary btn-sm"-->
<!--              [disabled]="ProjectForm.invalid"-->
<!--              *ngIf="is_reveiwer_user && EditMode && planned_status != 3"-->
<!--              (click)="DeclineProject()"-->
<!--            >-->
<!--              Decline-->
<!--            </button>-->


<!--          </div>-->
<!--        </form>-->
<!--      </div>-->
    </div>
  </div>

  <div class="row" *ngIf="showTabs" id="tabsDiv">
    <div class="col-md-12">
      <div class="box">
        <div class="box-header">
          <h3 class="box-title">{{ lblSelectedStratigicObjective }}</h3>
        </div>
        <div class="nav-tabs-custom">
          <ul class="nav nav-tabs">
            <li class="active">
              <a href="#tab_1" data-toggle="tab">{{
                  GetLocalResourceObject("lblTabRelatedKpis")
                }}</a>
            </li>
            <li>
              <a href="#tab_2" data-toggle="tab">Objectives Evidences Document</a>
            </li>
          </ul>
          <div class="tab-content">
            <div
              class="tab-pane active"
              id="tab_1"
              style="background-color: #ecf0f5"
            >
              <section class="content">
                <div class="row">
                  <div class="col-xs-12">
                    <div class="box">
                      <div class="box-header">
                        <h3 class="box-title">
                          {{ GetLocalResourceObject("lblObjKpiList") }}
                        </h3>
                        <div class="pull-right box-tools">
                          <button
                            type="button"
                            class="btn btn-success btn-sm"
                            *ngIf="hasEditPermission(undefined)"
                            (click)="ObjectiveKpiAdd()"
                            data-widget="Add"
                            data-toggle="tooltip"
                            title=""
                            data-original-title="Add"
                          >
                            <i class="fa fa-plus"></i>
                          </button>
                        </div>
                      </div>
                      <div class="box-body">
                        <div class="row">
                          <div class="col-xs-3">
                            <label>{{ GetLocalResourceObject("lblBSC") }}</label>
                            <select
                              class="form-control"
                              (change)="refreshObjKpisList()"
                              name="ddlObjBSC"
                              id="ddlObjBSC"
                              [(ngModel)]="ddlObjKpiBSCSearch"
                            >
                              <option value="" selected>
                                {{ GetLocalResourceObject("lblKpiBSCALLOption") }}
                              </option>
                              <option value="1">
                                {{
                                  GetLocalResourceObject(
                                    "lblKpiBSCFinancialOption"
                                  )
                                }}
                              </option>
                              <option value="2">
                                {{
                                  GetLocalResourceObject(
                                    "lblKpiBSCCustomersOption"
                                  )
                                }}
                              </option>
                              <option value="3">
                                {{
                                  GetLocalResourceObject(
                                    "lblKpiBSCInternalProcessOption"
                                  )
                                }}
                              </option>
                              <option value="4">
                                {{
                                  GetLocalResourceObject(
                                    "lblKpiBSCLearninggrowthOption"
                                  )
                                }}
                              </option>
                            </select>
                          </div>
                        </div>
                        <br/>
                        <DataGrid
                          #gvKPIs
                          [ShowButtons]="true"
                          [RowSelection]="false"
                          [AllowExportExcel]="false"
                          [HideFooter]="false"
                          (GridEvent)="gvKPIsHandler($event)"
                        >
                        </DataGrid>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row" *ngIf="showKpiEntry">
                  <div class="col-md-12">
                    <div class="box">
                      <div class="box-header">
                        <h3 class="box-title">
                          {{ GetLocalResourceObject("lblObjKpiEntry") }}
                        </h3>
                      </div>
                      <form #ObjectiveKPIsEntry="ngForm">
                        <div class="box-body">
                          <div style="margin-top:1rem;" class="row">
                            <div class="col-xs-5">
                              <label>{{
                                  GetLocalResourceObject("lblKpiName")
                                }}</label>
                              <input
                                class="form-control"
                                type="text"
                                name="txtKpiName"
                                id="txtKpiName"
                                [(ngModel)]="txtKpiName"
                                required
                                #txtKpiNameRef="ngModel"
                              />

                              <ValidatorCallOut
                                ID="txtKpiNameValidator"
                                [Visibiltiy]="
                                txtKpiNameRef.invalid && txtKpiNameRef.touched
                              "
                                [ControlToValidate]="txtKpiNameRef"
                                ErrorMessage="This field is required."
                              >
                              </ValidatorCallOut>
                            </div>
                            <div class="col-xs-7">
                              <label>{{
                                  GetLocalResourceObject("lblKpiDesc")
                                }}</label>
                              <textarea
                                class="form-control"
                                name="txtDesc"
                                id="txtDesc"
                                [(ngModel)]="txtKpiDesc"
                              >
                            </textarea>
                            </div>
                          </div>
                          <div style="margin-top:1rem;" class="row">
                            <div class="col-xs-3">
                              <label>{{
                                  GetLocalResourceObject("lblKpiMeasure")
                                }}</label>
                              <select
                                class="form-control"
                                required
                                name="ddlMeasurement"
                                id="ddlMeasurement"
                                [(ngModel)]="ddlKpiMeasurement"
                                #ddlKpiMeasurementRef="ngModel"
                              >
                                <option value="1">
                                  {{
                                    GetLocalResourceObject(
                                      "lblKpiMeasurePercentageOption"
                                    )
                                  }}
                                </option>
                                <option value="2">
                                  {{
                                    GetLocalResourceObject(
                                      "lblKpiMeasureValueOption"
                                    )
                                  }}
                                </option>
                              </select>

                              <ValidatorCallOut
                                ID="ddlKpiMeasurementValidator"
                                [Visibiltiy]="
                                ddlKpiMeasurementRef.invalid &&
                                ddlKpiMeasurementRef.touched
                              "
                                [ControlToValidate]="ddlKpiMeasurementRef"
                                ErrorMessage="This field is required."
                              >
                              </ValidatorCallOut>
                            </div>
                            <div class="col-xs-3">
                              <label>{{
                                  GetLocalResourceObject("lblKpiWeight")
                                }}</label>
                              <input
                                class="form-control"
                                [max]="remainingKPIWeight"
                                [min]="0"
                                required
                                type="number"
                                name="txtweight"
                                id="txtweight"
                                [(ngModel)]="txtKpiweight"
                                #txtKpiweightRef="ngModel"
                              />

                              <ValidatorCallOut
                                ID="txtKpiweightValidator"
                                [Visibiltiy]="
                                txtKpiweightRef.invalid &&
                                txtKpiweightRef.touched
                              "
                                [ControlToValidate]="txtKpiweightRef"
                                ErrorMessage="This field is required."
                              >
                              </ValidatorCallOut>
                            </div>
                            <div class="col-xs-3">
                              <label>{{
                                  GetLocalResourceObject("lblBSC")
                                }}</label>
                              <select
                                class="form-control"
                                required
                                name="ddlBSC"
                                id="ddlBSC"
                                [(ngModel)]="ddlKpiBSC"
                                #ddlKpiBSCRef="ngModel"
                              >
                                <option value="1">
                                  {{
                                    GetLocalResourceObject(
                                      "lblKpiBSCFinancialOption"
                                    )
                                  }}
                                </option>
                                <option value="2">
                                  {{
                                    GetLocalResourceObject(
                                      "lblKpiBSCCustomersOption"
                                    )
                                  }}
                                </option>
                                <option value="3">
                                  {{
                                    GetLocalResourceObject(
                                      "lblKpiBSCInternalProcessOption"
                                    )
                                  }}
                                </option>
                                <option value="4">
                                  {{
                                    GetLocalResourceObject(
                                      "lblKpiBSCLearninggrowthOption"
                                    )
                                  }}
                                </option>
                              </select>

                              <ValidatorCallOut
                                ID="ddlKpiBSCValidator"
                                [Visibiltiy]="
                                ddlKpiBSCRef.invalid && ddlKpiBSCRef.touched
                              "
                                [ControlToValidate]="ddlKpiBSCRef"
                                ErrorMessage="This field is required."
                              >
                              </ValidatorCallOut>
                            </div>
                            <div class="col-xs-3">
                              <label>{{
                                  GetLocalResourceObject("lblKPICycle")
                                }}</label>
                              <select
                                (change)="ddlKPICycleChange()"
                                [disabled]="EditMode"
                                required
                                class="form-control"
                                name="ddlKpiCycle"
                                id="ddlKpiCycle"
                                [(ngModel)]="KPICycleId"
                                #ddlKpiCycleRef="ngModel"
                              >
                                <option
                                  *ngFor="let x of KpiCycleLst"
                                  value="{{ x.MINOR_NO }}"
                                >
                                  {{ x.NAME }}
                                </option>
                              </select>

                              <ValidatorCallOut
                                ID="ddlKpiCycleValidator"
                                [Visibiltiy]="
                                ddlKpiCycleRef.invalid && ddlKpiCycleRef.touched
                              "
                                [ControlToValidate]="ddlKpiCycleRef"
                                ErrorMessage="This field is required."
                              >
                              </ValidatorCallOut>
                            </div>
                          </div>

                          <div style="margin-top:1rem;" class="row">
                            <div class="col-xs-3">
                              <label>{{
                                  GetLocalResourceObject("lblQ1Target")
                                }}</label>
                              <input
                                class="form-control"
                                [required]="Q1_Target_Required"
                                name="Q1Target"
                                type="number"
                                (input)="quarterTargetChange(KPITypeId)"
                                (blur)="BlurQ1Target()"
                                [disabled]="Q1_Disabled"
                                [(ngModel)]="Q1_Target"
                              />
                            </div>
                            <div class="col-xs-3">
                              <label>{{
                                  GetLocalResourceObject("lblQ2Target")
                                }}</label>
                              <input
                                class="form-control"
                                [required]="Q2_Target_Required"
                                name="Q2Target"
                                (input)="quarterTargetChange(KPITypeId)"

                                type="number"
                                (blur)="BlurQ2Target()"
                                [disabled]="Q2_Disabled"
                                [(ngModel)]="Q2_Target"
                              />
                            </div>
                            <div class="col-xs-3">
                              <label>{{
                                  GetLocalResourceObject("lblQ3Target")
                                }}</label>
                              <input
                                class="form-control"
                                [required]="Q3_Target_Required"
                                name="Q3Target"
                                (input)="quarterTargetChange(KPITypeId)"
                                type="number"
                                (blur)="BlurQ3Target()"
                                [disabled]="Q3_Disabled"
                                [(ngModel)]="Q3_Target"
                              />
                            </div>
                            <div class="col-xs-3">
                              <label>{{
                                  GetLocalResourceObject("lblQ4Target")
                                }}</label>
                              <input
                                class="form-control"
                                [required]="Q4_Target_Required"
                                name="Q4Target"
                                type="number"
                                (input)="quarterTargetChange(KPITypeId)"
                                (blur)="BlurQ4Target()"
                                [disabled]="Q4_Disabled"
                                [(ngModel)]="Q4_Target"
                              />
                            </div>
                          </div>
                          <div style="margin-top:1rem;" class="row">
                            <div class="col-xs-3">
                              <label> Better Up/Down </label>
                              <select
                                required
                                class="form-control"
                                name="ddlBetterUpDown"
                                id="ddlBetterUpDown"
                                [(ngModel)]="ddlBetterUpDown"
                                #ddlBetterUpDownRef="ngModel"
                                (change)="betterUpDownChange()"
                              >
                                <option
                                  *ngFor="let x of BetterUpDownList"
                                  value="{{ x.id }}"
                                >
                                  {{ x.name }}
                                </option>
                              </select>

                              <ValidatorCallOut
                                ID="betterUpDownValidator"
                                [Visibiltiy]="ddlBetterUpDownRef.invalid && ddlBetterUpDownRef.touched"
                                [ControlToValidate]="ddlBetterUpDownRef"
                                ErrorMessage="This field is required.">
                              </ValidatorCallOut>
                            </div>

                            <div class="col-xs-3">
                              <label>{{
                                  GetLocalResourceObject("lblKPIType")
                                }}</label>
                              <select
                                [disabled]="EditMode"
                                required
                                class="form-control"
                                name="ddlKpiType"
                                id="ddlKpiType"
                                [(ngModel)]="KPITypeId"
                                #ddlKpiTypeRef="ngModel"
                                (change)="changeKPIType(KPITypeId)"
                              >
                                <option
                                  *ngFor="let x of filteredKpiTypeLst"
                                  value="{{ x.MINOR_NO }}"
                                >
                                  {{ x.NAME }}
                                </option>
                              </select>

                              <ValidatorCallOut
                                ID="ddlKpiTypeValidator"
                                [Visibiltiy]="
                                ddlKpiTypeRef.invalid && ddlKpiTypeRef.touched
                              "
                                [ControlToValidate]="ddlKpiTypeRef"
                                ErrorMessage="This field is required."
                              >
                              </ValidatorCallOut>
                            </div>

                            <div class="col-xs-3">
                              <label>Annual Target</label>
                              <input
                                class="form-control"
                                required
                                type="number"
                                name="txtTarget"
                                id="txtTarget"
                                [(ngModel)]="txtKpiTarget"
                                #txtKpiTargetRef="ngModel"
                                disabled
                              />

                              <ValidatorCallOut
                                ID="txtKpiTargetValidator"
                                [Visibiltiy]="
                                txtKpiTargetRef.invalid &&
                                txtKpiTargetRef.touched
                              "
                                [ControlToValidate]="txtKpiTargetRef"
                                ErrorMessage="This field is required."
                              >
                              </ValidatorCallOut>
                            </div>
                          </div>
                        </div>

                        <div class="box-footer" style="text-align: right">
                          <button
                            [disabled]="ObjectiveKPIsEntry.invalid"
                            *ngIf="
                            (selectedObjectiveKpiId == null &&
                              selectedObjectiveKpiId == undefined) ||
                            planned_status == 1 ||
                            (is_reveiwer_user && planned_status == 3)
                          "
                            (click)="SaveObjectiveKpi()"
                            class="btn btn-primary"
                          >
                            {{ GetLocalResourceObject("btnKpiSave") }}
                          </button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </section>
            </div>
            <div class="tab-pane" id="tab_2" style="background-color: #ecf0f5">
              <section class="content">
                <div class="row">
                  <div class="col-xs-12">
                    <div class="row">
                      <div class="col-md-12" *ngIf="showTabs">
                        <div class="box">
                          <div class="box-header" style="vertical-align: middle">
                            <h3 class="box-title">
                              {{ GetLocalResourceObject("projEvidList") }}
                            </h3>
                            <div class="pull-right box-tools">
                              <button
                                *ngIf="hasEditPermission(undefined)"
                                type="button"
                                class="btn btn-success btn-sm btn-Add-right"
                                (click)="AddDocument()"
                                data-widget="Add"
                                data-toggle="tooltip"
                                title=""
                                data-original-title="Add"
                              >
                                <i class="fa fa-plus"></i>
                              </button>
                            </div>
                          </div>
                          <!-- /.box-header -->
                          <div class="box-body">
                            <DataGrid
                              #gvDocuments
                              [ShowButtons]="true"
                              [RowSelection]="false"
                              [AllowExportExcel]="false"
                              [HideFooter]="false"
                              (GridEvent)="gvDocumentsHandler($event)"
                            >
                            </DataGrid>
                          </div>
                          <!-- /.box-body -->
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div
                        class="col-md-12"
                        *ngIf="ShowDocumentEntry && showTabs"
                      >
                        <div class="box box-primary">
                          <div class="box-header with-border" *ngIf="!AddOnFly">
                            <h3 class="box-title">
                              {{ GetLocalResourceObject("projEvidEntry") }}
                            </h3>
                          </div>
                          <form #ProjectDocumentsForm="ngForm">
                            <div class="box-body">
                              <div class="row">
                                <div class="col-xs-12">
                                  <label>{{
                                      GetLocalResourceObject("docName")
                                    }}</label>
                                  <input
                                    type="text"
                                    required
                                    class="form-control"
                                    name="txtDocumentName"
                                    id="txtDocumentName"
                                    [(ngModel)]="txtDocumentName"
                                    #txtDocumentNameRef="ngModel"
                                  />

                                  <ValidatorCallOut
                                    ID="txtDocumentNameValidator"
                                    [Visibiltiy]="
                                    txtDocumentNameRef.invalid &&
                                    txtDocumentNameRef.touched
                                  "
                                    [ControlToValidate]="txtDocumentNameRef"
                                    ErrorMessage="This field is required."
                                  >
                                  </ValidatorCallOut>
                                </div>
                              </div>
                            </div>

                            <div class="box-footer text-right">
                              <button
                                class="btn btn-primary btn-sm"
                                [disabled]="ProjectDocumentsForm.invalid"
                                *ngIf="
                                !DocEditMode ||
                                planned_status == 1 ||
                                (is_reveiwer_user && planned_status == 3)
                              "
                                (click)="SaveProjectDocuments()"
                              >
                                {{ GetLocalResourceObject("btnSave") }}
                              </button>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </section>
            </div>
          </div>
        </div>

        <div class="box-footer">

          <a [routerLink]="['/Projects']" [fragment]="'project' + selectedId" (click)="scrollTo('project' + selectedId)">Back to Project</a>
        </div>
      </div>


      </div>
  </div>
</section>

<div class="modal fade" id="ActionPlanModal" style="display: none">
  <div
    class="modal-dialog modal-lg"
    style="overflow-y: auto; height: 500px; width: 90%"
  >
    <div class="modal-content">
      <div class="modal-header">
        <button
          type="button"
          class="close"
          (click)="closeActionPlanModal()"
          aria-label="Close"
        >
          <span aria-hidden="true">×</span>
        </button>
        <h4 class="modal-title">Action Plans</h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-12">
            <form role="form">
              <app-action-plan
                [AddOnFly]="true"
                #ActionPlanModal
              ></app-action-plan>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="approvalModal" style="display: none">
  <div
    class="modal-dialog modal-lg"
    style="overflow-y: auto; height: 500px; width: 90%"
  >
    <div class="modal-content">
      <div class="modal-header">
        <button
          type="button"
          class="close"
          (click)="closeApprovalModal()"
          aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
        <h4 class="modal-title">Project Planning Approval</h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-12" #approvalModal>

            <div class="box box-primary">
              <div class="box-header with-border">
                <h3 class="box-title">
                  Approvals
                </h3>
              </div>
              <form #ProjectForm="ngForm">
                <div class="box-body" #EntryPanel>


                  <table class="table table-hover" align="center">

                    <tbody>
                    <tr>
                      <th style="width: 15%">
                        Status
                      </th>
                      <th style="width: 15%">
                        Created By
                      </th>
                      <th style="width: 10%">
                        Date
                      </th>
                      <th style="width: 40%">
                        Note
                      </th>

                    </tr>
                    <ng-container *ngFor="let x of oProjects.Approvals; let i = index">
                      <tr
                        [style.background-color]="
                      x.style == 'service' ? '#959595' : ''
                   "
                      >
                        <td align="center" class="td-col3" style="font-size: 16px">
                          {{ x.Status == 2 ? "Confirmed" : x.Status == 1 ? "Waiting For Approval" : "Declined" }}
                        </td>
                        <td align="center" class="td-col3">{{ x.CreatedBy }}</td>
                        <td align="center" class="td-col3">{{ x.CreatedDate }}</td>
                        <td align="center" class="td-col3">{{ x.Note }}</td>


                      </tr>
                    </ng-container>
                    </tbody>
                  </table>
                  <!-- /.box-body -->
                </div>
                <div class="box-footer text-right">

                  <div class="margin-bottom">

              <textarea
                class="form-control"
                placeholder="Type your notes ..."
                rows="2"
                name="approvalNote"
                id="approvalNote"
                [(ngModel)]="approvalNote"
              ></textarea>
                  </div>
                  <button
                    class="btn btn-primary btn-sm"
                    [disabled]="ProjectForm.invalid"
                    *ngIf="is_reveiwer_user  && planned_status != 2"
                    (click)="ConfirmProject()"
                  >
                    Confirm
                  </button>
                  <button
                    class="btn btn-primary btn-sm"
                    [disabled]="ProjectForm.invalid"
                    *ngIf="is_reveiwer_user  && planned_status != 3"
                    (click)="DeclineProject()"
                  >
                    Decline
                  </button>


                </div>
              </form>
            </div>


          </div>
        </div>
      </div>
    </div>
  </div>
</div>
